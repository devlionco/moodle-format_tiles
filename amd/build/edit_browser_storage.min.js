define(["jquery","format_tiles/browser_storage_set_up"],function(a,b){"use strict";var c,d,e,f={PAGE:"#page",EDITING_COLLAPSE_SECID:"#collapse",EDITING_COLLAPSE_SEC:".collapse-section",EDITING_EXPAND_SEC:".expand-section",EDITING_EXPAND_SECID:"#expand",SECTION_CONTENT:"li.section.main .content",SECTION_MAIN:"li.section.main",SECTION_ID:"#section-"},g={COURSE_VISIT:"mdl-tiles-editing-last-visit-course-",EDITING_COURSE:"mdl-tiles-editing-course-",SECTION:"-section-",COURSE:"mdl-tiles-course-",LAST_SECTION:"-lastSecId",USER:"-user-",PREFIX:"mdl-tiles-",USER_CHOICE_PREFIX:"mdl-tiles-userPrefStorage-",CONTENT_SUFFIX:"-content",LAST_UPDATED_SUFFIX:"-lastUpdated"},h={OPEN:"1",CLOSED:"0"},i=function(a){return g.EDITING_COURSE+c+g.SECTION+a+g.USER+d},j=function(a){(!a||a>50)&&(a=50);for(var b,c=[],d=1;d<=a;d++)b=sessionStorage.getItem(i(d)),b===h.OPEN&&c.push(d);return c},k=function(){return g.COURSE+c+g.USER+d+g.LAST_SECTION},l=function(a){a?a!==e&&b.storageAllowed&&(e=a,localStorage.setItem(k(),a.toString())):localStorage.clear(k())},m=function(){return e||(e=localStorage.getItem(k())),e},n=function(a,c){b.storageAllowed&&c?sessionStorage.setItem(i(a),h.OPEN):sessionStorage.removeItem(i(a))},o=function(){Object.keys(sessionStorage).filter(function(a){return 0===a.indexOf(g.PREFIX)&&(a.indexOf(g.CONTENT_SUFFIX)===a.length-g.CONTENT_SUFFIX.length||a.indexOf(g.LAST_UPDATED_SUFFIX)===a.length-g.LAST_UPDATED_SUFFIX.length)}).forEach(function(a){sessionStorage.removeItem(a)})},p=function(){Object.keys(localStorage).filter(function(a){return 0===a.indexOf(g.PREFIX)&&a.indexOf(g.USER_CHOICE_PREFIX)===-1}).forEach(function(a){localStorage.removeItem(a)}),Object.keys(sessionStorage).filter(function(a){return 0===a.indexOf(g.PREFIX)&&a.indexOf(g.USER_CHOICE_PREFIX)===-1}).forEach(function(a){sessionStorage.removeItem(a)})};return{getOpenSections:function(a){return j(a)},init:function(e,h,i,j,k,m,q){c=h,d=e,m&&n(m,!0),a(document).ready(function(){if(b.init(d,k,p),o(),b.storageAllowed()){if(sessionStorage.setItem(g.COURSE_VISIT+c+g.USER+d,Date.now().toString()),q)for(var e=1;e<=m;e++)n(e,!1);a(f.PAGE).on("click",f.SECTION_CONTENT,function(b){var c=a(b.currentTarget),d=c.closest(f.SECTION_MAIN).attr("data-section");l(d)})}})},getLastSection:function(){return m()},setSectionStatus:function(a,b){return n(a,b)},setLastSection:function(a){return l(a)}}});